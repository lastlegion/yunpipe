#!/usr/bin/env python

import argparse
import json

from cloud_pipe.pipeline.set_pipe import main
from cloud_pipe.pipeline.task_config import get_task_credentials
from cloud_pipe.pipeline.__init__ import session
from cloud_pipe.pipeline.__init__ import USER_CREDENTIAL

parser = argparse.ArgumentParser(description='')

parser.add_argument('-uu', '--use_user_credential', action='store_true', help='use user credential to run ecs task, we suggest using a less privileged user for running ecs. For more information, see our docs')

parser.add_argument('-f', '--file', nargs='store',
                    help='json files to describe your work flow')

args = parser.parse_args()

credentials = get_task_credentials(args.use_user_credential)
with open(args.file, 'r') as tmpfile:
    user_request = json.load(tmpfile)
main(user_request, credentials)
